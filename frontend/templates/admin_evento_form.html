<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        {% if modo == 'crear' %}
          Crear Evento
        {% elif modo == 'clonar' %}
          Clonar Evento
        {% else %}
          Editar Evento
        {% endif %}
    </title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
    {% include "partials/header.html" %}
    
    <div class="container mt-5">
        
        <h2>
            {% if modo == 'crear' %}
              Crear nuevo evento
            {% elif modo == 'clonar' %}
              Clonar evento
            {% else %}
              Editar evento
            {% endif %}
        </h2>

        <form action="{% if modo in ['crear', 'clonar'] %}/admin/eventos/crear{% else %}/admin/eventos/{{ evento.id }}/editar{% endif %}" method="post" enctype="multipart/form-data">

            <div class="row">
                <div class="col-md-8">
                    <div class="mb-3">
                        <label class="form-label">Título *</label>
                        <input type="text" name="titulo" class="form-control" required value="{{ '' if modo == 'crear' else evento.titulo }}">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Descripción</label>
                        <textarea name="descripcion" class="form-control" rows="4" required>{{ '' if modo == 'crear' else evento.descripcion }}</textarea>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Ubicación (opcional)</label>
                        <input type="text" name="ubicacion" class="form-control"
                               value="{{ '' if modo == 'crear' else evento.ubicacion }}">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Dirección (opcional)</label>
                        <input type="text" name="direccion" class="form-control"
                               value="{{ '' if modo == 'crear' else evento.direccion }}">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Costo</label>
                        <input type="number" step="0.01" name="costo" class="form-control"
                        value="{{ '' if modo == 'crear' else evento.costo }}">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Categoría</label>
                        <select name="categoria_id" class="form-select">
                            <option value="">Sin categoría</option>
                            {% for cat in categorias %}
                                <option value="{{ cat.id }}" {% if modo != 'crear' and evento.categoria_id == cat.id %}selected{% endif %}>
                                    {{ cat.nombre }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Imagen del evento</label>
                        <div class="img-uploader-container">
                            <div class="img-uploader-subcontainer">
                                {% if modo != 'crear' and evento.imagen %}
                                    <img src="{{ evento.imagen }}" alt="Imagen del evento" style="max-width: 100%; height: auto;">
                                {% else %}
                                    <i class="fa-solid fa-image img-uploader-icon"></i>
                                {% endif %}
                                <input type="file" name="imagen" accept="image/*" onchange="previewImage(event)">
                            </div>
                        </div>
                        <small class="form-text text-muted mt-2">Formatos: JPG, PNG, GIF. Máximo: 5MB</small>
                    </div>
                </div>
            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> {% if modo == 'crear' %}Crear evento{% elif modo == 'clonar' %}Clonar evento{% else %}Actualizar evento{% endif %}
                </button>
                <a href="/admin/eventos" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Cancelar
                </a>
            </div>
        </form>
    </div>

    <script>
        function previewImage(event) {
            const container = document.querySelector('.img-uploader-subcontainer');
            if (!container) return;

            const img = container.querySelector('img');
            const icon = container.querySelector('.img-uploader-icon');

            const reader = new FileReader();
            reader.onload = function() {
                if (img) {
                    img.src = reader.result;
                } else if (icon) {
                    icon.outerHTML = '<img src="'+reader.result+'" alt="Imagen del evento" style="max-width: 100%; height: auto;">';
                }
            };
            reader.readAsDataURL(event.target.files[0]);
        }
    </script>

    <style>
        .img-uploader-container {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            position: relative;
            cursor: pointer;
        }

        .img-uploader-subcontainer {
            position: relative;
        }

        .img-uploader-icon {
            font-size: 3rem;
            color: #ccc;
        }

        .img-uploader-container input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .img-uploader-container:hover {
            border-color: #007bff;
        }
    </style>

    <script src="/static/script.js"></script>
</body>
</html>